<app-top-bar></app-top-bar>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)" mode="ios">
    <ion-refresher-content refreshingText="Cargando..."></ion-refresher-content>
  </ion-refresher>

  <div style="height: 100%; display: flex;" *ngIf="chats.getValue().length == 0">
    <div style="margin: auto;" class="ion-text-center animate__animated animate__fadeInUp">
      <img style="max-width: 20%;" src="../../assets/icon/primary/not-chat.png" alt="">
      <p>
        <ion-text color="medium">
          Aun no iniciaste ningun chat. Consulta con las inmobiliarias sobre las propiedades que te gustan.
        </ion-text>
      </p>
    </div>
  </div>

  <div *ngIf="chats.getValue().length > 0">
    <ion-list>
      <ion-item button *ngFor="let chat of chats | async;" (click)="openChat(chat)">
        <ion-avatar slot="start">
          <ion-img [src]="chat.image" *ngIf="chat.image" [class.hidden]="!imgIsLoad(false)"
            (ionImgDidLoad)="imgIsLoad(true)" class="animate__animated animate__fadeIn"></ion-img>
          <img src="../../assets/images/user.png" *ngIf="!chat.image">
        </ion-avatar>
        <ion-label>
          <h3>{{chat.name}}</h3>
          <p>{{chat.messages[chat.messages.length - 1]?.content}}</p>
          <p>{{chat.messages[chat.messages.length - 1]?.created_at | date:'dd/MM/yyyy, hh:mm aa'}}</p>
        </ion-label>
        <ion-badge color="success" slot="end" *ngIf="chat.unread_messages_count > 0">{{chat.unread_messages_count}}
        </ion-badge>
      </ion-item>
    </ion-list>
  </div>
</ion-content>